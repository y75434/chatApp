(function(e){function t(t){for(var n,r,o=t[0],c=t[1],l=t[2],d=0,f=[];d<o.length;d++)r=o[d],Object.prototype.hasOwnProperty.call(a,r)&&a[r]&&f.push(a[r][0]),a[r]=0;for(n in c)Object.prototype.hasOwnProperty.call(c,n)&&(e[n]=c[n]);u&&u(t);while(f.length)f.shift()();return i.push.apply(i,l||[]),s()}function s(){for(var e,t=0;t<i.length;t++){for(var s=i[t],n=!0,o=1;o<s.length;o++){var c=s[o];0!==a[c]&&(n=!1)}n&&(i.splice(t--,1),e=r(r.s=s[0]))}return e}var n={},a={app:0},i=[];function r(t){if(n[t])return n[t].exports;var s=n[t]={i:t,l:!1,exports:{}};return e[t].call(s.exports,s,s.exports,r),s.l=!0,s.exports}r.m=e,r.c=n,r.d=function(e,t,s){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},r.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(r.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(s,n,function(t){return e[t]}.bind(null,n));return s},r.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="/";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],c=o.push.bind(o);o.push=t,o=o.slice();for(var l=0;l<o.length;l++)t(o[l]);var u=c;i.push([0,"chunk-vendors"]),s()})({0:function(e,t,s){e.exports=s("56d7")},"0866":function(e,t,s){},"3d06":function(e,t,s){"use strict";s("0866")},4678:function(e,t,s){var n={"./af":"2bfb","./af.js":"2bfb","./ar":"8e73","./ar-dz":"a356","./ar-dz.js":"a356","./ar-kw":"423e","./ar-kw.js":"423e","./ar-ly":"1cfd","./ar-ly.js":"1cfd","./ar-ma":"0a84","./ar-ma.js":"0a84","./ar-sa":"8230","./ar-sa.js":"8230","./ar-tn":"6d83","./ar-tn.js":"6d83","./ar.js":"8e73","./az":"485c","./az.js":"485c","./be":"1fc1","./be.js":"1fc1","./bg":"84aa","./bg.js":"84aa","./bm":"a7fa","./bm.js":"a7fa","./bn":"9043","./bn-bd":"9686","./bn-bd.js":"9686","./bn.js":"9043","./bo":"d26a","./bo.js":"d26a","./br":"6887","./br.js":"6887","./bs":"2554","./bs.js":"2554","./ca":"d716","./ca.js":"d716","./cs":"3c0d","./cs.js":"3c0d","./cv":"03ec","./cv.js":"03ec","./cy":"9797","./cy.js":"9797","./da":"0f14","./da.js":"0f14","./de":"b469","./de-at":"b3eb","./de-at.js":"b3eb","./de-ch":"bb71","./de-ch.js":"bb71","./de.js":"b469","./dv":"598a","./dv.js":"598a","./el":"8d47","./el.js":"8d47","./en-au":"0e6b","./en-au.js":"0e6b","./en-ca":"3886","./en-ca.js":"3886","./en-gb":"39a6","./en-gb.js":"39a6","./en-ie":"e1d3","./en-ie.js":"e1d3","./en-il":"7333","./en-il.js":"7333","./en-in":"ec2e","./en-in.js":"ec2e","./en-nz":"6f50","./en-nz.js":"6f50","./en-sg":"b7e9","./en-sg.js":"b7e9","./eo":"65db","./eo.js":"65db","./es":"898b","./es-do":"0a3c","./es-do.js":"0a3c","./es-mx":"b5b7","./es-mx.js":"b5b7","./es-us":"55c9","./es-us.js":"55c9","./es.js":"898b","./et":"ec18","./et.js":"ec18","./eu":"0ff2","./eu.js":"0ff2","./fa":"8df4","./fa.js":"8df4","./fi":"81e9","./fi.js":"81e9","./fil":"d69a","./fil.js":"d69a","./fo":"0721","./fo.js":"0721","./fr":"9f26","./fr-ca":"d9f8","./fr-ca.js":"d9f8","./fr-ch":"0e49","./fr-ch.js":"0e49","./fr.js":"9f26","./fy":"7118","./fy.js":"7118","./ga":"5120","./ga.js":"5120","./gd":"f6b4","./gd.js":"f6b4","./gl":"8840","./gl.js":"8840","./gom-deva":"aaf2","./gom-deva.js":"aaf2","./gom-latn":"0caa","./gom-latn.js":"0caa","./gu":"e0c5","./gu.js":"e0c5","./he":"c7aa","./he.js":"c7aa","./hi":"dc4d","./hi.js":"dc4d","./hr":"4ba9","./hr.js":"4ba9","./hu":"5b14","./hu.js":"5b14","./hy-am":"d6b6","./hy-am.js":"d6b6","./id":"5038","./id.js":"5038","./is":"0558","./is.js":"0558","./it":"6e98","./it-ch":"6f12","./it-ch.js":"6f12","./it.js":"6e98","./ja":"079e","./ja.js":"079e","./jv":"b540","./jv.js":"b540","./ka":"201b","./ka.js":"201b","./kk":"6d79","./kk.js":"6d79","./km":"e81d","./km.js":"e81d","./kn":"3e92","./kn.js":"3e92","./ko":"22f8","./ko.js":"22f8","./ku":"2421","./ku.js":"2421","./ky":"9609","./ky.js":"9609","./lb":"440c","./lb.js":"440c","./lo":"b29d","./lo.js":"b29d","./lt":"26f9","./lt.js":"26f9","./lv":"b97c","./lv.js":"b97c","./me":"293c","./me.js":"293c","./mi":"688b","./mi.js":"688b","./mk":"6909","./mk.js":"6909","./ml":"02fb","./ml.js":"02fb","./mn":"958b","./mn.js":"958b","./mr":"39bd","./mr.js":"39bd","./ms":"ebe4","./ms-my":"6403","./ms-my.js":"6403","./ms.js":"ebe4","./mt":"1b45","./mt.js":"1b45","./my":"8689","./my.js":"8689","./nb":"6ce3","./nb.js":"6ce3","./ne":"3a39","./ne.js":"3a39","./nl":"facd","./nl-be":"db29","./nl-be.js":"db29","./nl.js":"facd","./nn":"b84c","./nn.js":"b84c","./oc-lnc":"167b","./oc-lnc.js":"167b","./pa-in":"f3ff","./pa-in.js":"f3ff","./pl":"8d57","./pl.js":"8d57","./pt":"f260","./pt-br":"d2d4","./pt-br.js":"d2d4","./pt.js":"f260","./ro":"972c","./ro.js":"972c","./ru":"957c","./ru.js":"957c","./sd":"6784","./sd.js":"6784","./se":"ffff","./se.js":"ffff","./si":"eda5","./si.js":"eda5","./sk":"7be6","./sk.js":"7be6","./sl":"8155","./sl.js":"8155","./sq":"c8f3","./sq.js":"c8f3","./sr":"cf1e","./sr-cyrl":"13e9","./sr-cyrl.js":"13e9","./sr.js":"cf1e","./ss":"52bd","./ss.js":"52bd","./sv":"5fbd","./sv.js":"5fbd","./sw":"74dc","./sw.js":"74dc","./ta":"3de5","./ta.js":"3de5","./te":"5cbb","./te.js":"5cbb","./tet":"576c","./tet.js":"576c","./tg":"3b1b","./tg.js":"3b1b","./th":"10e8","./th.js":"10e8","./tk":"5aff","./tk.js":"5aff","./tl-ph":"0f38","./tl-ph.js":"0f38","./tlh":"cf75","./tlh.js":"cf75","./tr":"0e81","./tr.js":"0e81","./tzl":"cf51","./tzl.js":"cf51","./tzm":"c109","./tzm-latn":"b53d","./tzm-latn.js":"b53d","./tzm.js":"c109","./ug-cn":"6117","./ug-cn.js":"6117","./uk":"ada2","./uk.js":"ada2","./ur":"5294","./ur.js":"5294","./uz":"2e8c","./uz-latn":"010e","./uz-latn.js":"010e","./uz.js":"2e8c","./vi":"2921","./vi.js":"2921","./x-pseudo":"fd7e","./x-pseudo.js":"fd7e","./yo":"7f33","./yo.js":"7f33","./zh-cn":"5c3a","./zh-cn.js":"5c3a","./zh-hk":"49ab","./zh-hk.js":"49ab","./zh-mo":"3a6c","./zh-mo.js":"3a6c","./zh-tw":"90ea","./zh-tw.js":"90ea"};function a(e){var t=i(e);return s(t)}function i(e){if(!s.o(n,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return n[e]}a.keys=function(){return Object.keys(n)},a.resolve=i,e.exports=a,a.id="4678"},"56d7":function(e,t,s){"use strict";s.r(t);s("e260"),s("e6cf"),s("cca6"),s("a79d");var n=s("2b0e"),a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("v-app",[s("v-main",[s("router-view")],1)],1)},i=[],r={name:"App",data:function(){return{}}},o=r,c=s("2877"),l=s("6544"),u=s.n(l),d=s("7496"),f=s("f6c4"),h=Object(c["a"])(o,a,i,!1,null,null,null),m=h.exports;u()(h,{VApp:d["a"],VMain:f["a"]});var v=s("8c4f"),p=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[e._m(0),e.loading?s("div",{staticClass:"alert alert-info"},[e._v("請稍候......")]):e._e(),e.hasErrors?s("div",{staticClass:"alert alert-danger"},e._l(e.errors,(function(t){return s("div",{key:t.id},[e._v(e._s(t))])})),0):e._e(),s("div",{staticClass:"container-fluid"},[s("div",{staticClass:"row mt-5"},[s("div",{staticClass:"col text-center"},[s("button",{staticClass:"btn btn-outline-danger",attrs:{type:"button"},on:{click:function(t){return e.loginWithGoogle()}}},[e._v("Google登入")])])])])])},b=[function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"jumbotron bg-primary text-white p-3 text-center"},[s("h1",[e._v("Go Chat")]),s("p",[e._v("您的好幫手")])])}],g=s("2591"),j={name:"Login",data:function(){return{email:"",password:"",forgot_password:"",errors:[],loading:!1,usersRef:g["a"].database().ref("users")}},computed:{hasErrors:function(){return this.errors.length>0}},methods:{login:function(){var e=this;this.errors=[],this.isLoading=!0,g["a"].auth().signInWithEmailAndPassword(this.email,this.password).then((function(t){var s=t.user;e.$store.dispatch("setUser",s),e.$router.push("/")})).catch((function(t){e.errors.push(t.message),e.isLoading=!1}))},loginWithGoogle:function(){var e=this;this.loading=!0,this.errors=[],g["a"].auth().signInWithPopup(new g["a"].auth.GoogleAuthProvider).then((function(t){e.saveUserToUsersRef(t.user),e.$store.dispatch("setUser",t.user),e.$router.push("/")})).catch((function(t){e.errors.push(t.message),e.loading=!1}))},saveUserToUsersRef:function(e){return this.usersRef.child(e.uid).set({name:e.displayName,avatar:e.photoURL})},loginWithTwitter:function(){this.loading=!0,this.errors=[],g["a"].auth().signInWithPopup(new g["a"].auth.TwitterAuthProvider).then((function(e){}))}}},C=j,_=Object(c["a"])(C,p,b,!1,null,null,null),y=_.exports,k=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("v-container",[s("v-row",[s("v-col",{attrs:{cols:"12",sm:"4",md:"4"}},[s("Sidebar")],1),s("v-col",{attrs:{cols:"12",sm:"8",md:"8"}},[s("Messages")],1)],1)],1)},w=[],R=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("v-card",{attrs:{tile:""}},[s("v-navigation-drawer",{attrs:{permanent:"",height:"100%"}},[s("v-system-bar"),s("v-list",[s("v-list-item",[s("v-list-item-avatar",[s("v-img",{attrs:{src:e.currentUser.photoURL}})],1)],1),s("v-list-item",{attrs:{link:""}},[s("v-list-item-content",[s("v-list-item-title",{staticClass:"title"},[e._v(" "+e._s(e.currentUser.displayName)+" ")]),s("button",{staticClass:"btn btn-light",on:{click:e.logout}},[e._v("登出")])],1)],1)],1),s("v-divider"),s("v-list",{attrs:{nav:"",dense:""}},[s("v-list-item-group",{attrs:{color:"primary"},model:{value:e.selectedItem,callback:function(t){e.selectedItem=t},expression:"selectedItem"}},[e._l(e.items,(function(t,n){return s("v-list-item",{key:n},[s("v-list-item-icon",[s("v-icon",{domProps:{textContent:e._s(t.icon)}})],1),s("v-list-item-content",[s("v-list-item-title",{domProps:{textContent:e._s(t.text)}})],1)],1)})),s("v-list-item",{attrs:{link:""}},[s("v-list-item-icon",[s("v-icon",{},[e._v("mdi-plus")])],1),s("v-list-item-content",[s("v-list-item-title",[e._v("Add Channel")])],1),s("button",{staticClass:"btn btn-primary",attrs:{type:"button"},on:{click:function(t){return e.openModal()}}},[e._v(" 新增頻道 ")]),s("div",{staticClass:"modal fade",attrs:{id:"channelModal"}},[s("div",{staticClass:"modal-dialog"},[s("div",{staticClass:"modal-content"},[s("div",{staticClass:"modal-header"},[s("h5",{staticClass:"modal-title"},[e._v("Modal title")]),s("button",{staticClass:"btn-close",attrs:{type:"button","data-bs-dismiss":"modal","aria-label":"Close"}})]),s("div",{staticClass:"modal-body"},[s("form",[s("div",{staticClass:"form-group"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.new_channel,expression:"new_channel"}],staticClass:"form-control",attrs:{type:"text",id:"new_channel",name:"new_channel",placeholder:"Channel name"},domProps:{value:e.new_channel},on:{input:function(t){t.target.composing||(e.new_channel=t.target.value)}}})]),e.hasErrors?s("ul",{staticClass:"list-group"},e._l(e.errors,(function(t){return s("li",{key:t.id,staticClass:"list-group-item text-danger"},[e._v(e._s(t))])})),0):e._e()])]),s("div",{staticClass:"modal-footer"},[s("button",{staticClass:"btn btn-secondary",attrs:{type:"button","data-bs-dismiss":"modal"},on:{click:e.closeModal}},[e._v("取消")]),s("button",{staticClass:"btn btn-primary",attrs:{type:"button"},on:{click:e.addChannel}},[e._v("新增頻道")])])])])])],1),s("Channels"),s("Users")],2)],1)],1)],1)},M=[],U=s("5530"),x=s("2f62"),P=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("v-card",{staticClass:"mx-auto"},[s("v-list",[s("v-list-item-group",{attrs:{color:"primary"}},e._l(e.channels,(function(t){return s("v-list-item",{key:t.id,on:{click:function(s){return e.changeChannel(t)}}},[s("v-list-item-content",[s("v-list-item-title",[e._v(e._s(t.name))])],1)],1)})),1)],1)],1)},T=[],I=(s("159b"),s("c740"),{methods:{handleNotifications:function(e,t,s,n){var a=0,i=s.findIndex((function(t){return t.id===e}));-1!==i?(e!==t&&(a=s[i].total,n.numChildren()-a>0&&(s[i].notif=n.numChildren()-a)),s[i].lastKnownTotal=n.numChildren()):s.push({id:e,total:n.numChildren(),lastKnownTotal:n.numChildren(),notif:0})}}}),L={name:"channels",data:function(){return{new_channel:"",errors:[],channelsRef:g["a"].database().ref("channels"),messagesRef:g["a"].database().ref("messages"),notifCount:[],channels:[],channel:null}},mixins:[I],computed:Object(U["a"])(Object(U["a"])({},Object(x["b"])(["currentChannel","isPrivate"])),{},{hasErrors:function(){return this.errors.length>0}}),watch:{isPrivate:function(){this.isPrivate&&this.resetNotifications()}},methods:{addChannel:function(){var e=this;this.errors=[];var t=this.channelsRef.push().key,s={id:t,name:this.new_channel};console.log(s),this.channelsRef.child(t).update(s).then((function(){e.$store.dispatch("setCurrentChannel",s),e.new_channel="",$("#channelModal").modal("hide")})).catch((function(t){e.errors.push(t.message)}))},addListeners:function(){var e=this;this.channelsRef.on("child_added",(function(t){e.channels.push(t.val()),e.channels.length>0&&(e.channel=e.channels[0],e.$store.dispatch("setCurrentChannel",e.channel)),e.addCountListener(t.key)}))},addCountListener:function(e){var t=this;this.messagesRef.child(e).on("value",(function(s){t.handleNotifications(e,t.currentChannel.id,t.notifCount,s)}))},getNotification:function(e){var t=0;return this.notifCount.forEach((function(s){s.id===e.id&&(t=s.notif)})),t},setActiveChannel:function(e){return e.id===this.currentChannel.id},changeChannel:function(e){this.resetNotifications(),this.$store.dispatch("setPrivate",!1),this.$store.dispatch("setCurrentChannel",e),this.channel=e},resetNotifications:function(){var e=this,t=this.notifCount.findIndex((function(t){return t.id===e.channel.id}));-1!==t&&(this.notifCount[t].total=this.notifCount[t].lastKnownTotal,this.notifCount[t].notif=0)},detachListeners:function(){var e=this;this.channelsRef.off(),this.channel.forEach((function(t){e.messagesRef.child(t.id).off()}))}},mounted:function(){this.addListeners()},beforeDestroy:function(){this.detachListeners()}},O=L,E=s("b0af"),V=s("8860"),N=s("da13"),S=s("5d23"),z=s("1baa"),F=Object(c["a"])(O,P,T,!1,null,null,null),A=F.exports;u()(F,{VCard:E["a"],VList:V["a"],VListItem:N["a"],VListItemContent:S["a"],VListItemGroup:z["a"],VListItemTitle:S["b"]});var D=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",e._l(e.users,(function(t){return s("v-list-item",{key:t.id,on:{click:function(s){return s.preventDefault(),e.changeChannel(t)}}},[s("v-img",{attrs:{src:t.avatar,height:"10"}}),s("v-list-item-content",[s("v-list-item-title",[e._v(e._s(t.name))])],1)],1)})),1)},G=[],W=(s("b0c0"),{name:"users",data:function(){return{users:[],usersRef:g["a"].database().ref("users"),connectedRef:g["a"].database().ref(".info/connected"),presenceRef:g["a"].database().ref("presence"),privateMessagesRef:g["a"].database().ref("privateMessages"),notifCount:[],channel:null}},mixins:[I],computed:Object(U["a"])({},Object(x["b"])(["currentUser","currentChannel","isPrivate"])),watch:{isPrivate:function(){this.isPrivate||this.resetNotifications()}},methods:{addListeners:function(){var e=this;this.usersRef.on("child_added",(function(t){if(e.currentUser.uid!==t.key){var s=t.val();s.uid=t.key,s.status="offline",e.users.push(s)}})),this.presenceRef.on("child_added",(function(t){if(e.currentUser.uid!==t.key){e.addStatusToUser(t.key);var s=e.getChannelId(t.key);e.privateMessagesRef.child(s).on("value",(function(t){e.handleNotifications(s,e.currentChannel.id,e.notifCount,t)}))}})),this.presenceRef.on("child_removed",(function(t){e.currentUser.uid!==t.key&&(e.addStatusToUser(t.key,!1),e.privateMessagesRef.child(e.getChannelId(t.key)).off())})),this.connectedRef.on("value",(function(t){if(!0===t.val()){var s=e.presenceRef.child(e.currentUser.uid);s.set(!0),s.onDisconnect().remove()}}))},addStatusToUser:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],s=this.users.findIndex((function(t){return t.uid===e}));-1!==s&&(this.users[s].status=!0===t?"online":"offline")},isOnline:function(e){return"online"===e.status},getNotification:function(e){var t=this.getChannelId(e.uid),s=0;return this.notifCount.forEach((function(e){e.id===t&&(s=e.notif)})),s},resetNotifications:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=null;t=null!==e?this.getChannelId(e.uid):this.channel.id;var s=this.notifCount.findIndex((function(e){return e.id===t}));-1!==s&&(this.notifCount[s].total=this.notifCount[s].lastKnownTotal,this.notifCount[s].notif=0)},detachListeners:function(){var e=this;this.usersRef.off(),this.presenceRef.off(),this.connectedRef.off(),this.channels.forEach((function(t){e.messagesRef.child(t.id).off()}))},changeChannel:function(e){null===this.channel?this.resetNotifications(e):this.resetNotifications();var t=this.getChannelId(e.uid),s={id:t,name:e.name};this.channel=s,this.$store.dispatch("setPrivate",!0),this.$store.dispatch("setCurrentChannel",s)},isActive:function(e){var t=this.getChannelId(e.uid);return this.currentChannel.id===t},getChannelId:function(e){return e<this.currentUser.uid?e+"/"+this.currentUser.uid:this.currentUser.uid+"/"+e}},mounted:function(){this.addListeners()},beforeDestroy:function(){this.detachListeners()}}),Y=W,K=s("adda"),q=Object(c["a"])(Y,D,G,!1,null,null,null),B=q.exports;u()(q,{VImg:K["a"],VListItem:N["a"],VListItemContent:S["a"],VListItemTitle:S["b"]});var H={name:"Sidebar",components:{Channels:A,Users:B},data:function(){return{presenceRef:g["a"].database().ref("presence"),selectedItem:0,items:[{text:"My Files",icon:"mdi-folder"},{text:"Starred",icon:"mdi-star"},{text:"Recent",icon:"mdi-history"},{text:"Offline",icon:"mdi-check-circle"},{text:"Uploads",icon:"mdi-upload"},{text:"Backups",icon:"mdi-cloud-upload"}]}},computed:Object(U["a"])({},Object(x["b"])(["currentUser"])),methods:{openModal:function(){$("#channelModal").modal("show")},closeModal:function(){$("#channelModal").modal("hide")},logout:function(){this.presenceRef.child(this.currentUser.uid).remove(),g["a"].auth().signOut(),this.$store.dispatch("setUser",null),this.$router.push("/login")}}},J=H,Q=s("ce7e"),Z=s("132d"),X=s("8270"),ee=s("34c3"),te=s("f774"),se=s("afd9"),ne=Object(c["a"])(J,R,M,!1,null,null,null),ae=ne.exports;u()(ne,{VCard:E["a"],VDivider:Q["a"],VIcon:Z["a"],VImg:K["a"],VList:V["a"],VListItem:N["a"],VListItemAvatar:X["a"],VListItemContent:S["a"],VListItemGroup:z["a"],VListItemIcon:ee["a"],VListItemTitle:S["b"],VNavigationDrawer:te["a"],VSystemBar:se["a"]});var ie=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("v-card",[s("h2",[e._v(e._s(e.channelName))]),s("SingleMessage",{attrs:{messages:e.messages}}),s("MessageForm")],1)},re=[],oe=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("div",{staticClass:"mt-3 mb-5 h-100"},e._l(e.messages,(function(t){return s("div",{key:t.id},[s("div",{staticClass:"media"},[s("img",{staticClass:"align-self-start mr-3",attrs:{src:t.user.avatar,height:"50"}}),s("div",{staticClass:"media-body"},[s("h5",{staticClass:"mt-0"},[s("a",{attrs:{href:"#"}},[e._v(e._s(t.user.name))]),e._v(" - "+e._s(e._f("fromNow")(t.timestamp))+" ")]),e.isFile(t)?s("img",{staticClass:"img img-responsive",attrs:{height:"200",src:t.image,alt:"image"}}):s("p",[e._v(e._s(t.content))])])])])})),0)])},ce=[],le=s("c1df"),ue=s.n(le),de={name:"single-message",props:["messages"],computed:Object(U["a"])({},Object(x["b"])(["currentUser"])),methods:{selfMessage:function(e){return e.id===this.currentUser.uid},isFile:function(e){return null==e.content}},filters:{fromNow:function(e){return ue()(e).format("MMMM Do YYYY, h:mm:ss a")}}},fe=de,he=(s("3d06"),Object(c["a"])(fe,oe,ce,!1,null,"de914bee",null)),me=he.exports,ve=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("div",{staticClass:"messageform"},[s("form",{on:{submit:function(t){return t.preventDefault(),e.sendMessage(t)}}},[s("div",{staticClass:"input-group mb-3"},[s("input",{directives:[{name:"model",rawName:"v-model.trim",value:e.message,expression:"message",modifiers:{trim:!0}}],staticClass:"form-control mt-3",attrs:{name:"message",id:"message",placeholder:"請輸入"},domProps:{value:e.message},on:{input:function(t){t.target.composing||(e.message=t.target.value.trim())},blur:function(t){return e.$forceUpdate()}}}),s("div",{staticClass:"input-group-append"},[s("button",{staticClass:"btn btn-primary mt-3",attrs:{type:"button"},on:{click:e.sendMessage}},[e._v("傳送")])]),s("div",{staticClass:"input-group-append"},[s("button",{staticClass:"btn btn-warning mt-3",attrs:{type:"button"},on:{click:function(t){return t.preventDefault(),e.openFileModal(t)}}},[e._v("選擇照片")])])])]),s("file-modal",{ref:"file_modal"})],1)])},pe=[],be=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("div",{staticClass:"modal fade",attrs:{id:"fileModal"}},[s("div",{staticClass:"modal-dialog"},[s("div",{staticClass:"modal-content"},[e._m(0),s("div",{staticClass:"modal-body"},[s("form",{staticClass:"form"},[s("div",{staticClass:"form-group"},[s("input",{staticClass:"form-control",attrs:{type:"file",id:"file",name:"file"},on:{change:e.addFile}})])])]),s("div",{staticClass:"modal-footer"},[s("button",{staticClass:"btn btn-primary",attrs:{type:"button"},on:{click:e.sendFile}},[e._v("傳送檔案")])])])])])])},ge=[function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"modal-header"},[s("h5",{staticClass:"modal-title",attrs:{id:"exampleModalLabel"}},[e._v("上傳檔案")]),s("button",{staticClass:"btn-close",attrs:{type:"button","data-bs-dismiss":"modal","aria-label":"Close"}})])}],je=s("cc1d"),Ce=s.n(je),_e={name:"file-modal",data:function(){return{file:null,authorized:["image/jpeg","image/jpg","image/png"]}},methods:{isValid:function(e){var t=this.authorized.indexOf(Ce.a.lookup(e));return-1!==t},addFile:function(e){var t=e.target.files;1===t.length&&(this.file=t[0])},sendFile:function(){if(null!==this.file&&this.isValid(this.file.name)){var e={contentType:Ce.a.lookup(this.file.name)};this.$parent.uploadFile(this.file,e),$("#fileModal").modal("hide")}},resetForm:function(){$(".form").trigger("reset"),this.file=null}}},ye=_e,ke=Object(c["a"])(ye,be,ge,!1,null,null,null),we=ke.exports,Re=s("1157"),Me=s.n(Re),Ue=s("11c1"),xe={name:"message-form",components:{FileModal:we},data:function(){return{message:"",errors:[],storageRef:g["a"].storage().ref(),messagesRef:g["a"].database().ref("messages"),privateMessagesRef:g["a"].database().ref("privateMessages"),uploadTask:null}},computed:Object(U["a"])({},Object(x["b"])(["currentChannel","currentUser","isPrivate"])),methods:{sendMessage:function(){var e={content:this.message,timestamp:g["a"].database.ServerValue.TIMESTAMP,user:{name:this.currentUser.displayName,avatar:this.currentUser.photoURL,id:this.currentUser.uid}};null!==this.currentChannel&&this.message.length>0&&(this.isPrivate?this.privateMessagesRef.child(this.currentChannel.id).push().set(e):this.messagesRef.child(this.currentChannel.id).push().set(e),this.message="")},sendPhoto:function(e){var t={content:null,timestamp:g["a"].database.ServerValue.TIMESTAMP,user:{name:this.currentUser.displayName,avatar:this.currentUser.photoURL,id:this.currentUser.uid}};t.image=e,null!==this.currentChannel&&(this.isPrivate?this.privateMessagesRef.child(this.currentChannel.id).push().set(t):this.messagesRef.child(this.currentChannel.id).push().set(t),this.fileUrl="")},uploadFile:function(e,t){var s=this;if(null===e)return!1;var n=this.currentChannel.id,a=this.getMessagesRef(),i=this.getPath()+"/"+Object(Ue["v4"])()+".jpg";this.uploadTask=this.storageRef.child(i).put(e,t),this.uploadTask.on("state_changed",(function(e){}),(function(e){s.errors.push(e.message),s.uploadTask=null,s.$refs.file_modal.resetForm()}),(function(){s.$refs.file_modal.resetForm(),s.uploadTask.snapshot.ref.getDownloadURL().then((function(e){s.sendFileMessage(e,a,n)}))}))},sendFileMessage:function(e,t,s){var n=this;t.child(s).push().set(this.sendPhoto(e)).then((function(){n.$nextTick((function(){Me()("html, body").scrollTop(Me()(document).height())}))})).catch((function(e){n.errors.push(e.message)}))},getPath:function(){return this.isPrivate?"chat/private/"+this.currentChannel.id:"chat/public"},openFileModal:function(){Me()("#fileModal").modal("show")},getMessagesRef:function(){return this.isPrivate?this.privateMessagesRef:this.messagesRef}},mounted:function(){Me()("html, body").scrollTop(Me()(document).height())},beforeDestroy:function(){null!==this.uploadTask&&(this.uploadTask.cancel(),this.uploadTask=null)}},Pe=xe,Te=Object(c["a"])(Pe,ve,pe,!1,null,null,null),Ie=Te.exports,Le={name:"messages",components:{SingleMessage:me,MessageForm:Ie},data:function(){return{messagesRef:g["a"].database().ref("messages"),privateMessagesRef:g["a"].database().ref("privateMessages"),messages:[],channel:null,listeners:[]}},computed:Object(U["a"])(Object(U["a"])({},Object(x["b"])(["currentChannel","currentUser","isPrivate"])),{},{channelName:function(){return null!==this.channel?this.isPrivate?"@ "+this.channel.name:"# "+this.channel.name:"Welcome"}}),watch:{currentChannel:function(){this.detachListeners(),this.addListeners(),this.channel=this.currentChannel}},methods:{addListeners:function(){var e=this,t=this.getMessagesRef();t.child(this.currentChannel.id).on("child_added",(function(t){var s=t.val();s.id=t.key,e.messages.push(s)})),this.addToListeners(this.currentChannel.id,t,"child_added")},addToListeners:function(e,t,s){var n=this.listeners.findIndex((function(n){return n.id===e&&n.ref===t&&n.event===s}));-1===n&&this.listeners.push({id:e,ref:t,event:s})},detachListeners:function(){this.listeners.forEach((function(e){e.ref.child(e.id).off(e.event)})),this.listeners=[],this.messages=[]},getMessagesRef:function(){return this.isPrivate?this.privateMessagesRef:this.messagesRef},beforeDestroy:function(){this.detachListeners()}}},Oe=Le,Ee=Object(c["a"])(Oe,ie,re,!1,null,null,null),$e=Ee.exports;u()(Ee,{VCard:E["a"]});var Ve={name:"Chat",components:{Sidebar:ae,Messages:$e}},Ne=Ve,Se=(s("fe2a"),s("62ad")),ze=s("a523"),Fe=s("0fd9"),Ae=Object(c["a"])(Ne,k,w,!1,null,"39c56ce5",null),De=Ae.exports;u()(Ae,{VCol:Se["a"],VContainer:ze["a"],VRow:Fe["a"]});var Ge=s("260b");n["a"].use(v["a"]);var We=[{path:"/",name:"chat",component:De,beforeEnter:function(e,t,s){Ge["a"].auth().currentUser?s():s("/login")}},{path:"/login",name:"Login",component:y}],Ye=new v["a"]({mode:"history",base:"/",routes:We}),Ke=Ye;n["a"].use(x["a"]);var qe={currentUser:null,currentChannel:null,isPrivate:!1},Be={SET_USER:function(e,t){e.currentUser=t},SET_CURRENT_CHANNEL:function(e,t){e.currentChannel=t},SET_PRIVATE:function(e,t){e.isPrivate=t}},He={setUser:function(e,t){e.commit("SET_USER",t)},setCurrentChannel:function(e,t){var s=e.commit;s("SET_CURRENT_CHANNEL",t)},setPrivate:function(e,t){var s=e.commit;s("SET_PRIVATE",t)}},Je={currentUser:function(e){return e.currentUser},currentChannel:function(e){return e.currentChannel},isPrivate:function(e){return e.isPrivate}},Qe=new x["a"].Store({state:qe,mutations:Be,actions:He,getters:Je}),Ze=Qe,Xe=(s("4989"),s("f309"));n["a"].use(Xe["a"]);var et=new Xe["a"]({});window.$=Me.a,n["a"].config.productionTip=!1;var tt={apiKey:"AIzaSyDnZUYzlqGFNwvPfQFG7DoOYAljlSMutGI",authDomain:"chat-8de40.firebaseapp.com",projectId:"chat-8de40",storageBucket:"chat-8de40.appspot.com",messagingSenderId:"880185915464",appId:"1:880185915464:web:7c9d5637d746416ec9407d"};Ge["a"].initializeApp(tt),window.firebase=Ge["a"];var st=Ge["a"].auth().onAuthStateChanged((function(e){Ze.dispatch("setUser",e),new n["a"]({router:Ke,store:Ze,vuetify:et,render:function(e){return e(m)}}).$mount("#app"),st()}))},5728:function(e,t,s){},fe2a:function(e,t,s){"use strict";s("5728")}});
//# sourceMappingURL=app.5c8da6de.js.map